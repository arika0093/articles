---
import type { CollectionEntry } from "astro:content";
import { Icon } from "astro-icon/components";
import { SITE } from "@/config";

type Props = {
  class?: string;
  post: CollectionEntry<"blog">;
};

const { post, class: className = "" } = Astro.props;

// Transform the filePath from copied blog to original articles directory
// Example: src/data/blog/2026/20260106/source-generator-trap.md -> articles/2026/20260106/#source-generator-trap.md
const transformFilePath = (filePath?: string): string => {
  if (!filePath) return "";
  // Remove 'src/data/blog/' prefix
  const relativePath = filePath.replace(/^src\/data\/blog\//, "");
  // Split into directory and filename
  const parts = relativePath.split("/");
  if (parts.length >= 3) {
    const year = parts[0];
    const date = parts[1];
    const filename = parts[2];
    // Add # prefix back to filename (it was removed during copy)
    return `articles/${year}/${date}/%23${filename}`;
  }
  // Fallback to original path if structure is unexpected
  return filePath;
};

const href = `${SITE.editPost.url}${transformFilePath(post.filePath)}`;
const showEditPost = SITE.editPost.enabled && href.trim() !== "";
---

{
  showEditPost && (
    <a
      href={href}
      target="_blank"
      rel="noopener noreferrer"
      class:list={[
        "flex justify-baseline gap-1.5 opacity-80 hover:text-accent",
        className,
      ]}
    >
      <Icon name="tabler:edit" class="mt-1 inline-block size-5" />
      <span>{SITE.editPost.text}</span>
    </a>
  )
}
